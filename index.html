<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="manifest" href="/site.webmanifest">
        <title>Base Converter</title>
        <meta name="description" content="Program to convert numbers to different bases">
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <div id="main">
            <div id="colors">
            <fieldset>
                <legend>Create your own background color</legend>
                <label>Red
                <input id="red" type="range" min=0 max=255 step=1></input></label>
                <label>Green
                <input id="green" type="range" min=0 max=255 step=1></input></label>
                <label>Blue
                <input id="blue" type="range" min=0 max=255 step=1></input></label>
            </fieldset>
            <fieldset>
                <legend>Create your own text color</legend>
                <label>Red
                <input id="redText" type="range" min=0 max=255 step=1></input></label>
                <label>Green
                <input id="greenText" type="range" min=0 max=255 step=1></input></label>
                <label>Blue
                <input id="blueText" type="range" min=0 max=255 step=1></input></label>
            </fieldset>
            </div>
            <h1>Convert numbers to different bases</h1>
            <p>To enter a number in binary, preface with '0b', eg: 0x10101</p>
            <p>To enter a number in octal, preface with '0o', eg: 0o51</p>
            <p>To enter a number in hexadecimal, preface with '0x'</p>
            <p><span title="Options include: binary, ternary, quaternary, quinary, senary, septenary, octal, nonary, decimal, unadecimal, duodecimal, tridecimal, tetradecimal, pentadecimal, hexadecimal, heptadecimal, octodecimal, enneadecimal, vigesimal, unvigesimal, duovigesimal, trivigesimal, tetravigesimal, pentavigesimal, hexavigesimal, heptavigesimal, octovigesimal, enneavigesimal, trigesimal, untrigesimal, duotrigesimal, tritrigesimal, tetratrigesimal, pentatrigesimal, hexatrigesimal">Radix can be any number between 2 and 36 or the name for that base system.</span>
            </p>
            <form id="baseConverter">
            <label for="number">Number</label>
                <input id="number"/>
            
            <label for="radix">Radix</label>
                <input id="radix"/>
            <button id="convertButton">Convert!</button>
            </form>
            <div id="solution"></div>
            <div id="error"></div>
        </div>
        <script src=/js/loader.js></script>
        <script src="https://cdn.jsdelivr.net/npm/@assemblyscript/loader/umd/index.js"></script>
        <script src="https://unpkg.com/wasm-feature-detect/dist/umd/index.js"></script>
        <script>
            // Background color start
            const redRange = document.getElementById("red");
            const greenRange = document.getElementById("green");
            const blueRange = document.getElementById("blue");
            if (localStorage.getItem("red")) {
                redRange.value = localStorage.getItem("red");
            } else {
                redRange.value = 0;
                localStorage.setItem("red", 0);
            }
            if (localStorage.getItem("green")) {
                greenRange.value = localStorage.getItem("green");
            } else {
                greenRange.value = 0;
                localStorage.setItem("green", 0);
            }
            if (localStorage.getItem("blue")) {
                blueRange.value = localStorage.getItem("blue");
            } else {
                blueRange.value = 0;
                localStorage.setItem("blue", 0);
            }
            document.body.style.backgroundColor = `rgb(${redRange.value},${greenRange.value},${blueRange.value})`;
            redRange.addEventListener('change', (e) => {
                localStorage.setItem("red", e.target.value);
                const color = `rgb(${e.target.value},${greenRange.value},${blueRange.value})`;
                localStorage.setItem("backgroundColor", color);
                document.body.style.backgroundColor = color;
            })
            greenRange.addEventListener('change', (e) => {
                localStorage.setItem("green", e.target.value);
                const color = `rgb(${redRange.value},${e.target.value},${blueRange.value})`;
                localStorage.setItem("backgroundColor", color);
                document.body.style.backgroundColor = color;
            });
            blueRange.addEventListener('change', (e) => {
                localStorage.setItem("blue", e.target.value);
                const color = `rgb(${redRange.value},${greenRange.value},${e.target.value})`;
                localStorage.setItem("backgroundColor", color);
                document.body.style.backgroundColor = color;
            })
            // Background color end
            // Text color start
            const redRangeText = document.getElementById("redText");
            const greenRangeText = document.getElementById("greenText");
            const blueRangeText = document.getElementById("blueText");
            if (localStorage.getItem("redText")) {
                redRangeText.value = localStorage.getItem("redText");
            } else {
                redRangeText.value = 255;
                localStorage.setItem("redText", 255);
            }
            if (localStorage.getItem("greenText")) {
                greenRangeText.value = localStorage.getItem("greenText");
            } else {
                greenRangeText.value = 255;
                localStorage.setItem("greenText", 255);
            }
            if (localStorage.getItem("blueText")) {
                blueRangeText.value = localStorage.getItem("blueText");
            } else {
                blueRangeText.value = 255;
                localStorage.setItem("blueText", 255);
            }
            [...document.querySelectorAll('p')].forEach(p => p.style.color = `rgb(${redRangeText.value},${greenRangeText.value},${blueRangeText.value})`);
            [...document.querySelectorAll("legend")].forEach(legend => legend.style.color = `rgb(${redRangeText.value},${greenRangeText.value},${blueRangeText.value})`);
            [...document.querySelectorAll("label")].forEach(label => label.style.color = `rgb(${redRangeText.value},${greenRangeText.value},${blueRangeText.value})`);
            document.querySelector("h1").style.color = `rgb(${redRangeText.value},${greenRangeText.value},${blueRangeText.value})`;
            redRangeText.addEventListener('change', (e) => {
                localStorage.setItem("redText", e.target.value);
                const color = `rgb(${e.target.value},${greenRangeText.value},${blueRangeText.value})`;
                localStorage.setItem("color", color);
                [...document.querySelectorAll('p')].forEach(p => p.style.color = color);
                [...document.querySelectorAll("legend")].forEach(legend => legend.style.color = color);
                [...document.querySelectorAll("label")].forEach(label => label.style.color = color);
                document.querySelector("h1").style.color = color;
            })
            greenRangeText.addEventListener('change', (e) => {
                localStorage.setItem("greenText", e.target.value);
                const color = `rgb(${redRangeText.value},${e.target.value},${blueRangeText.value})`;
                localStorage.setItem("color", color);
                [...document.querySelectorAll('p')].forEach(p => p.style.color = color);
                [...document.querySelectorAll("legend")].forEach(legend => legend.style.color = color);
                [...document.querySelectorAll("label")].forEach(label => label.style.color = color);
                document.querySelector("h1").style.color = color;
            });
            blueRangeText.addEventListener('change', (e) => {
                localStorage.setItem("blueText", e.target.value);
                const color = `rgb(${redRangeText.value},${greenRangeText.value},${e.target.value})`;
                localStorage.setItem("color", color);
                [...document.querySelectorAll('p')].forEach(p => p.style.color = color);
                [...document.querySelectorAll("legend")].forEach(legend => legend.style.color = color);
                [...document.querySelectorAll("label")].forEach(label => label.style.color = color);
                document.querySelector("h1").style.color = color;

            })
            // Text color end
        </script>
        <script>
            const numericInput = document.getElementById("number");
            const radixInput = document.getElementById("radix");
            const form = document.getElementById("baseConverter");
            const solution = document.getElementById("solution");
            const error = document.getElementById("error");
            const WL = new WasmLoader();
            WL.wasm('/build/optimized.wasm')
                .then(instance => {
                const { convert, convertStringRadix, convert32, convertStringRadix32, __getString, __newString } = instance;
                let number, radix;
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    number = numericInput.value;
                    radix = radixInput.value;
                    wasmFeatureDetect.bigInt().then(bigIntSupported => {
                        /* Safari does not support BigInt, so special case to only allow up to 0xFFFFFFFF */
                        if (bigIntSupported) {
                            if ((!isNaN(number) && ((number.length === 20 && +number[number.length - 1] > 5) || number.length > 20 || number <= 0)) || isNaN(number)) {
                                error.textContent = "Could not process request.  ";
                                if (!isNaN(number) && ((number.length === 20 && +number[number.length - 1] > 5) || number.length > 20)) {
                                    error.textContent += "Number entered must be less than 18446744073709551616.  ";
                                }
                                if (!isNaN(number) && +number <= 0) {
                                    error.textContent += "Number entered must be greater than 0.  ";
                                }
                                if (isNaN(number)) {
                                    error.textContent += "Number entered must be a valid number.  ";
                                }
                                if (radix < 2 || /^[3][7-9]|[4-9][0-9]|\d{3,}$/.test(radix) || (isNaN(radix) && ["binary", "ternary", "quaternary", "quinary", "senary", "septenary", "octal", "nonary", "decimal", "unadecimal", "duodecimal", "tridecimal", "tetradecimal", "pentadecimal", "hexadecimal", "heptadecimal", "octodecimal", "enneadecimal", "vigesimal", "unvigesimal", "duovigesimal", "trivigesimal", "tetravigesimal", "pentavigesimal", "hexavigesimal", "heptavigesimal", "octovigesimal", "enneavigesimal", "trigesimal", "untrigesimal", "duotrigesimal", "tritrigesimal", "tetratrigesimal", "pentatrigesimal", "hexatrigesimal"].includes(radix) === false)) {
                                    error.textContent += "Radix must be between 2 and 36."
                                }
                                error.style.color = `rgb(${redRangeText.value},${greenRangeText.value},${blueRangeText.value})`;
                            } else {
                                try {
                                    const str = __getString(convert(number, radix));
                                    const newSolution = document.createElement("p");
                                    newSolution.textContent += number + " in base " + radix + " = " + str.toUpperCase();
                                    newSolution.style.color = `rgb(${redRangeText.value},${greenRangeText.value},${blueRangeText.value})`;
                                    solution.appendChild(newSolution);
                                    numericInput.value = "";
                                    radixInput.value = "";
                                    error.textContent = "";
                                } catch (err) {
                                    console.log('Error', err);
                                    const base = __newString(radix.toLowerCase());
                                    const str = __getString(convertStringRadix(number, base));
                                    if (str !== "") {
                                        const newSolution = document.createElement("p");
                                        newSolution.textContent += number + " in " + radix + " = " + str.toUpperCase();
                                        newSolution.style.color = `rgb(${redRangeText.value},${greenRangeText.value},${blueRangeText.value})`;
                                        solution.appendChild(newSolution);
                                        numericInput.value = "";
                                        radixInput.value = "";
                                        error.textContent = "";
                                    } else {
                                        error.textContent = "Could not process request.  ";
                                        if (!["binary", "ternary", "quaternary", "quinary", "senary", "septenary", "octal", "nonary", "decimal", "unadecimal", "duodecimal", "tridecimal", "tetradecimal", "pentadecimal", "hexadecimal", "heptadecimal", "octodecimal", "enneadecimal", "vigesimal", "unvigesimal", "duovigesimal", "trivigesimal", "tetravigesimal", "pentavigesimal", "hexavigesimal", "heptavigesimal", "octovigesimal", "enneavigesimal", "trigesimal", "untrigesimal", "duotrigesimal", "tritrigesimal", "tetratrigesimal", "pentatrigesimal", "hexatrigesimal"].includes(radix)) {
                                            error.textContent += "Radix must be between 2 and 36."
                                            error.style.color = `rgb(${redRangeText.value},${greenRangeText.value},${blueRangeText.value})`;
                                        }
                                    }
                                }
                            }
                        } else {
                            if ((!isNaN(number) && ((number.length === 10 && +number[number.length - 1] > 5) || number.length > 10 || number <= 0)) || isNaN(number)) {
                                error.textContent = "Could not process request.  ";
                                    if (!isNaN(number) && ((number.length === 10 && +number[number.length - 1] > 5) || number.length > 10)) {
                                        error.textContent += "Number entered must be less than 4294967296.  ";
                                    }
                                    if (!isNaN(number) && +number <= 0) {
                                        error.textContent += "Number entered must be greater than 0.  ";
                                    }
                                    if (isNaN(number)) {
                                        error.textContent += "Number entered must be a valid number.  ";
                                    }
                                    if (radix < 2 || /^[3][7-9]|[4-9][0-9]|\d{3,}$/.test(radix) || (isNaN(radix) && ["binary", "ternary", "quaternary", "quinary", "senary", "septenary", "octal", "nonary", "decimal", "unadecimal", "duodecimal", "tridecimal", "tetradecimal", "pentadecimal", "hexadecimal", "heptadecimal", "octodecimal", "enneadecimal", "vigesimal", "unvigesimal", "duovigesimal", "trivigesimal", "tetravigesimal", "pentavigesimal", "hexavigesimal", "heptavigesimal", "octovigesimal", "enneavigesimal", "trigesimal", "untrigesimal", "duotrigesimal", "tritrigesimal", "tetratrigesimal", "pentatrigesimal", "hexatrigesimal"].includes(radix) === false)) {
                                        error.textContent += "Radix must be between 2 and 36."
                                    }
                                    error.style.color = `rgb(${redRangeText.value},${greenRangeText.value},${blueRangeText.value})`;
                            } else {
                                try {
                                    const str = __getString(convert32(number, radix));
                                    const newSolution = document.createElement("p");
                                    newSolution.textContent += number + " in base " + radix + " = " + str.toUpperCase();
                                    newSolution.style.color = `rgb(${redRangeText.value},${greenRangeText.value},${blueRangeText.value})`;
                                    solution.appendChild(newSolution);
                                    numericInput.value = "";
                                    radixInput.value = "";
                                    error.textContent = "";
                                } catch (err) {
                                    console.log('Error', err);
                                    const base = __newString(radix.toLowerCase());
                                    const str = __getString(convertStringRadix32(number, base));
                                    if (str !== "") {
                                        const newSolution = document.createElement("p");
                                        newSolution.textContent += number + " in " + radix + " = " + str.toUpperCase();
                                        newSolution.style.color = `rgb(${redRangeText.value},${greenRangeText.value},${blueRangeText.value})`;
                                        solution.appendChild(newSolution);
                                        numericInput.value = "";
                                        radixInput.value = "";
                                        error.textContent = "";
                                    } else {
                                        error.textContent = "Could not process request.  ";
                                        if (!["binary", "ternary", "quaternary", "quinary", "senary", "septenary", "octal", "nonary", "decimal", "unadecimal", "duodecimal", "tridecimal", "tetradecimal", "pentadecimal", "hexadecimal", "heptadecimal", "octodecimal", "enneadecimal", "vigesimal", "unvigesimal", "duovigesimal", "trivigesimal", "tetravigesimal", "pentavigesimal", "hexavigesimal", "heptavigesimal", "octovigesimal", "enneavigesimal", "trigesimal", "untrigesimal", "duotrigesimal", "tritrigesimal", "tetratrigesimal", "pentatrigesimal", "hexatrigesimal"].includes(radix)) {
                                            error.textContent += "Radix must be between 2 and 36."
                                        }
                                        error.style.color = `rgb(${redRangeText.value},${greenRangeText.value},${blueRangeText.value})`;
                                    }
                                }
                            }
                        }
                    })
                })
            });
        </script>
    </body>
</html>