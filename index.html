<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
        <link rel="manifest" href="/site.webmanifest">
        <title>Base Converter</title>
        <meta name="description" content="Program to convert numbers to different bases">
    </head>
<body>
    <div id="main">
        <h1>Convert numbers to different bases</h1>
        <p>To enter a number in binary, preface with '0b', eg: 0x10101</p>
        <p>To enter a number in octal, preface with '0o', eg: 0o51</p>
        <p>To enter a number in hexadecimal, preface with '0x'</p>
        <p><span title="Options include: binary, ternary, quaternary, quinary, senary, septenary, octal, nonary, decimal, unadecimal, duodecimal, tridecimal, tetradecimal, pentadecimal, hexadecimal, heptadecimal, octodecimal, enneadecimal, vigesimal, unvigesimal, duovigesimal, trivigesimal, tetravigesimal, pentavigesimal, hexavigesimal, heptavigesimal, octovigesimal, enneavigesimal, trigesimal, untrigesimal, duotrigesimal, tritrigesimal, tetratrigesimal, pentatrigesimal, hexatrigesimal">Radix can be any number between 2 and 36 or the name for that base system.</span>
        </p>
        <form id="baseConverter">
        <label>Number
            <input id="number"/>
        </label>
        <label>Radix
            <input id="radix"/>
        </label>
        <button id="convertButton">Convert!</button>
        </form>
        <div id="solution"></div>
        <div id="error"></div>
    </div>
    <script src=/js/loader.js></script>
    <script src="https://cdn.jsdelivr.net/npm/@assemblyscript/loader/umd/index.js"></script>

    <script>
        const numericInput = document.getElementById("number");
        const radixInput = document.getElementById("radix");
        const form = document.getElementById("baseConverter");
        const solution = document.getElementById("solution");
        const error = document.getElementById("error");
        const WL = new WasmLoader();
        WL.wasm('/build/optimized.wasm')
            .then(instance => {
            const { convert, convertStringRadix, getRadix, __getString, __newString } = instance;
            let number, radix;
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                number = numericInput.value;
                radix = radixInput.value;
                if (!isNaN(number) && ((number.length === 20 && +number[number.length - 1] > 5) || number.length > 20 || number <= 0)) {
                    error.textContent = "Could not process request.  ";
                        if (!isNaN(number) && ((number.length === 20 && +number[number.length - 1] > 5) || number.length > 20)) {
                            error.textContent += "Number entered must be less than 18446744073709551616.  ";
                        }
                        if (!isNaN(number) && +number <= 0) {
                            error.textContent += "Number entered must be greater than 0.  ";
                        }
                        if (isNaN(number)) {
                            error.textContent += "Number entered must be a valid number.  ";
                        }
                        if (/^[3][7-9]|[4-9][0-9]|\d{3,}$/.test(radix) || (isNaN(radix) && ["binary", "ternary", "quaternary", "quinary", "senary", "septenary", "octal", "nonary", "decimal", "unadecimal", "duodecimal", "tridecimal", "tetradecimal", "pentadecimal", "hexadecimal", "heptadecimal", "octodecimal", "enneadecimal", "vigesimal", "unvigesimal", "duovigesimal", "trivigesimal", "tetravigesimal", "pentavigesimal", "hexavigesimal", "heptavigesimal", "octovigesimal", "enneavigesimal", "trigesimal", "untrigesimal", "duotrigesimal", "tritrigesimal", "tetratrigesimal", "pentatrigesimal", "hexatrigesimal"].includes(radix) === false)) {
                            error.textContent += "Radix must be between 2 and 36."
                        }
                } else {
                    try {
                        const str = __getString(convert(number, radix));
                        const newSolution = document.createElement("p");
                        newSolution.textContent += number + " in base " + radix + " = " + str.toUpperCase();
                        solution.appendChild(newSolution);
                        numericInput.value = "";
                        radixInput.value = "";
                        error.textContent = "";
                    } catch (err) {
                        const base = __newString(radix);
                        const str = __getString(convertStringRadix(number, base));
                        if ((!isNaN(number) && +number <= 18446744073709551615) && +number > 0 && str !== "") {
                            const newSolution = document.createElement("p");
                            newSolution.textContent += number + " in " + radix + " = " + str.toUpperCase();
                            solution.appendChild(newSolution);
                            numericInput.value = "";
                            radixInput.value = "";
                            error.textContent = "";
                        } else {
                            error.textContent = "Could not process request.  ";
                            if (!isNaN(number) && +number > 18446744073709551616) {
                                error.textContent += "Number entered must be less than 18446744073709551616.  ";
                            }
                            if (!isNaN(number) && +number < 0) {
                                error.textContent += "Number entered must be greater than 0.  ";
                            }
                            if (isNaN(number)) {
                                error.textContent += "Number entered must be a valid number.  ";
                            }
                            if (!["binary", "ternary", "quaternary", "quinary", "senary", "septenary", "octal", "nonary", "decimal", "unadecimal", "duodecimal", "tridecimal", "tetradecimal", "pentadecimal", "hexadecimal", "heptadecimal", "octodecimal", "enneadecimal", "vigesimal", "unvigesimal", "duovigesimal", "trivigesimal", "tetravigesimal", "pentavigesimal", "hexavigesimal", "heptavigesimal", "octovigesimal", "enneavigesimal", "trigesimal", "untrigesimal", "duotrigesimal", "tritrigesimal", "tetratrigesimal", "pentatrigesimal", "hexatrigesimal"].includes(radix)) {
                                error.textContent += "Radix must be between 2 and 36."
                            }
                        }
                    }
                }
            })
        });
    </script>
</body>
</html>